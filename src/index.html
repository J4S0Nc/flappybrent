<html>

<head>
	<title>Flappy Brent</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<link rel="manifest" href="manifest.json">
	<meta name="theme-color" content="#96c93e" />
	<link rel="icon" sizes="192x192" href="assets/brent0.png">
	<link rel="apple-touch-icon" href="assets/brent0.png">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="#96c93e">
	<meta name="apple-mobile-web-app-title" content="Flappy Brent">
	<meta name="msapplication-TileImage" content="assets/brent0.png">
	<meta name="msapplication-TileColor" content="#96c93e">
	<meta property="og:site_name" content="Flappy Brent" />
	<meta property="og:title" content="Get the beers! Don't get the Brents!" />
	<meta name="description" content="There is no winning in Flappy Brent. Get the beers, don't get the Brents" />
	<meta property="og:description"
		content="There is no winning in Flappy Brent. How many beers can you drink before Brent blocks you?" />
	<meta property="og:image" content="https://flappybrent.z13.web.core.windows.net/assets/flappybrent.png">
	<meta property="og:url" content="https://flappybrent.z13.web.core.windows.net/">
	<meta property="og:type" content="website" />


	<style>
		* {
			box-sizing: border-box;
			margin: 0;
			padding: 0;
			touch-action: none;
		}

		body,
		html {
			width: 100%;
			height: 100%;
			background: #333;
		}

		body {
			position: fixed;
		}

		#container {
			display: grid;
			height: 100%;
		}

		#viewport {
			max-width: 100%;
			max-height: 100%;
			margin: auto;
			background: #000;
		}

		#loading {
			position: absolute;
			display: block;
			height: 300px;
			width: 300px;
			left: 50%;
			top: 50%;
			margin-top: -150px;
			margin-left: -150px;
			color: white;
			text-align: center;
		}
	</style>
</head>

<body>
	<div id="loading">
		<h1>Loading...</h1>
		<br><br>
		<img src="assets/brent0.png" />
	</div>
	<div id="container" style="display: none">
		<noscript><strong>We're sorry but the web doesn't work properly without JavaScript enabled. Enable it to stop
				being an idiot.</strong></noscript>
		<canvas id='viewport' width='1920' height='1080'></canvas>

	</div>
	<script>
		if ('serviceWorker' in navigator) {
			navigator.serviceWorker.register('service-worker.js')
				.then(function () {
					console.log('Service Worker Registered');
				});
		}
		function loadAssets() {
			loadImg('assets/background0.png')
			loadImg('assets/brent0.png')
			loadImg('assets/empty0.png')
			loadImg('assets/green0.png')
			let i = 0
			for (i = 0; i < 3; i++) { loadImg(`assets/beer${i}.png`) }
			for (i = 0; i < 4; i++) { loadImg(`assets/EddieFlap${i}.png`) }
			for (i = 0; i < 3; i++) { loadImg(`assets/beer${i}.png`) }

		}
		function loadImg(a) {
			totalImgs++
			const im = new Image()
			im.src = a
			im.onload = imagesLoaded
		}
		let totalImgs = 0
		let loadedImgs = 0
		function imagesLoaded() {
			loadedImgs++;
			if (loadedImgs === totalImgs) {
				console.log('All images loaded!');
				const container = document.getElementById('container')
				const loading = document.getElementById('loading')
				loading.style.display = 'none';
				container.style.display = 'block';
			}
		}

		loadAssets()

	</script>
	<script type='module'>

		import Game from './game.js'
		import View from './view.js'

		const TICK = 1000 / 240 // 240 updates / second

		let game = new Game()
		const view = new View()
		const canvas = document.getElementById('viewport')
		const ctx = canvas.getContext('2d', { alpha: false })
		const input = []

		document.addEventListener('keyup', () => input.push(true))
		if ('ontouchstart' in window) {
			document.addEventListener('touchstart', () => input.push(true))
		} else {
			document.addEventListener('click', () => input.push(true))
		}

		let time = performance.now()
		requestAnimationFrame(loop)

		function loop() {
			requestAnimationFrame(loop)

			const now = performance.now()
			while (time + TICK <= now) {
				const flapping = input.shift()
				const finished = game.update(flapping)
				if (finished && flapping && game.gameOver) game = new Game() //start new game
				time += TICK
			}

			view.render(game, ctx)

		}
		function fullscreen() {
			if (canvas.webkitRequestFullScreen) {
				canvas.webkitRequestFullScreen()
			}
			else if (canvas.mozRequestFullScreen) {
				canvas.mozRequestFullScreen()
			}
		}

	</script>
</body>

</html>